
@using Quanlythuquanweb.Models
@model Quanlythuquanweb.Models.ThanhVien
@{
    ViewBag.Title = "Profile";
}
@{
    Layout = null;
}

<meta charset="utf-8" />
<title>Thông tin cá nhân - Lịch sử hoạt động | THUQUAN.COM</title>
<style>
    body {
        margin: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f5f5dc;
    }

    /* Top bar */
    .top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 30px;
        background-color: rgba(164, 104, 46, 0.85);
        color: white;
        font-weight: bold;
        font-size: 18px;
        position: relative;
        z-index: 10;
    }

        .top-bar .logo {
            font-family: Georgia, serif;
            font-size: 24px;
            opacity: 0.7;
        }

        .top-bar nav a {
            color: white;
            text-decoration: none;
            margin-left: 25px;
            font-weight: 500;
        }

            .top-bar nav a:hover {
                text-decoration: underline;
            }

        .top-bar .icons {
            display: flex;
            align-items: center;
            gap: 15px;
        }

            .top-bar .icons .bell {
                width: 22px;
                height: 22px;
                cursor: pointer;
                filter: brightness(0) invert(1);
            }

            .top-bar .icons .profile-circle {
                width: 30px;
                height: 30px;
                border-radius: 50%;
                background-color: #cbb994;
                cursor: pointer;
            }

    /* Header Banner */
    .header-banner {
/*        background: url('https://i.imgur.com/n0vYqTm.jpg') no-repeat center center/cover;
        position: relative;*/
        color: burlywood;
        padding: 40px 60px;
        min-height: 300px;
        display: flex;
        align-items: center;
    }

        .header-banner .profile-img {
            flex-shrink: 0;
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            margin-right: 50px;
        }

            .header-banner .profile-img img {
                width: 130px;
                height: 130px;
                object-fit: contain;
            }

        .header-banner .profile-info {
            max-width: 600px;
            font-size: 18px;
        }

            .header-banner .profile-info h1 {
                margin: 0 0 12px 0;
                font-family: "Georgia", serif;
                font-size: 38px;
                font-weight: 600;
            }

            .header-banner .profile-info p {
                margin: 5px 0;
            }

        .header-banner .section-label {
            font-size: 14px;
            font-weight: 400;
            letter-spacing: 1px;
            margin-bottom: 6px;
            opacity: 0.8;
        }

        .header-banner .border-line {
            position: absolute;
            bottom: 18px;
            left: 60px;
            width: 260px;
            height: 1px;
            background-color: white;
            opacity: 0.6;
        }

    /* Main content */
    .main-content {
        display: flex;
        margin: 30px 60px 60px 60px;
        background-color: #fffdeb;
        border: 1px solid #ccc;
        padding: 15px;
        min-height: 280px;
    }

    /* Sidebar */
    .sidebar {
        width: 200px;
        background-color: #ac7f49;
        border-radius: 4px 0 0 4px;
        box-shadow: inset -3px 0 4px rgba(0,0,0,0.15);
        display: flex;
        flex-direction: column;
    }

        .sidebar button {
            background-color: #ac7f49;
            border: none;
            padding: 15px 20px;
            font-weight: 600;
            font-size: 16px;
            color: #4f2200;
            text-align: left;
            cursor: pointer;
            border-left: 5px solid transparent;
            transition: background-color 0.3s, border-left-color 0.3s, color 0.3s;
        }

            .sidebar button:hover {
                background-color: #7a4406;
                color: white;
            }

            .sidebar button.active {
                background-color: #7a4406;
                color: white;
                border-left-color: #4a2400;
            }

    /* Content area */
    .content-area {
        flex-grow: 1;
        padding-left: 30px;
    }

    /* Table */
    table {
        border-collapse: collapse;
        width: 100%;
        margin-top: 10px;
    }

    th, td {
        border: 1px solid #999;
        padding: 10px 15px;
        text-align: center;
        font-weight: 600;
        font-size: 16px;
    }

    th {
        background-color: #bfbdb1;
    }

    td {
        background-color: #fefefe;
        font-weight: 500;
    }

    /* Buttons in table */
    .detail-btn {
        background-color: #7a4406;
        border: none;
        color: white;
        padding: 5px 10px;
        font-size: 14px;
        cursor: pointer;
        border-radius: 2px;
        transition: background-color 0.3s;
    }

        .detail-btn:hover {
            background-color: #ac7f49;
        }

    /* Footer */
    footer {
        background-color: #2d1700;
        color: #e3ddd0;
        padding: 25px 60px;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        font-size: 14px;
    }

        footer .footer-container {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        footer section {
            max-width: 300px;
            margin-bottom: 20px;
            line-height: 1.5;
        }

            footer section h4 {
                margin-bottom: 10px;
                font-weight: 700;
            }

            footer section a {
                color: #cbb994;
                text-decoration: none;
                display: block;
                margin-bottom: 6px;
                font-style: italic;
            }

                footer section a:hover {
                    text-decoration: underline;
                }

        footer .address-info {
            font-style: italic;
        }

    

    {
        flex-direction: column;
    }

    .sidebar {
        width: 100%;
        flex-direction: row;
        border-radius: 4px 4px 0 0;
    }

        .sidebar button {
            flex-grow: 1;
            text-align: center;
            border-left: none;
            border-bottom: 3px solid transparent;
        }

            .sidebar button.active {
                border-left: none;
                border-bottom: 3px solid #4a2400;
            }

    .content-area {
        padding-left: 0;
        margin-top: 25px;
    }

    footer .footer-container {
        flex-direction: column;
        align-items: center;
    }

    footer section {
        max-width: 100%;
        text-align: center;
    }

    }

    .btn-edit {
        background-color: #2d1700;
        color: #e3ddd0;
        padding: 12px 14px;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        font-size: 16px;
    }

        .btn-edit:hover {
            background-color: peru;
            cursor: pointer;
        }

    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.6); /* Tối nền */
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
    }

    .modal-content {
        background: white;
        padding: 20px 30px;
        border-radius: 10px;
        max-width: 400px;
        text-align: left;
        box-shadow: 0 0 20px rgba(0,0,0,0.2);
    }

    .btn-closemodal {
        background-color: #2d1700;
        color: #e3ddd0;
        padding: 12px 14px;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        font-size: 16px;
    }

        .btn-closemodal:hover {
            background-color: peru;
            cursor: pointer;
        }
</style>
</head>
<body>
    <!-- Top Bar -->
    <header class="top-bar">
        <div class="logo">THUQUAN.COM</div>
        <nav>
            <a href="#">Trang chủ</a>
            <a href="#">Thủ tục</a>
            <a href="#">Liên hệ</a>
            <a href="#">Cá nhân</a>
        </nav>
        <div class="icons">
            <svg class="bell" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M12 24c1.104 0 1.99-.896 1.99-2h-3.98c0 1.104.886 2 1.99 2zm6.364-6v-5c0-3.079-1.639-5.641-4.364-6.32v-.68c0-.826-.675-1.5-1.5-1.5s-1.5.674-1.5 1.5v.68c-2.725.679-4.364 3.241-4.364 6.32v5l-1.636 1.636v.364h15v-.364l-1.636-1.636z" /></svg>
            <div class="profile-circle"></div>
        </div>
    </header>

    <!-- Header Banner -->
    <section class="header-banner" aria-label="Thông tin cá nhân">
        @* <div class="profile-img" aria-hidden="true">
                <img src="~/Views/Home/imgs/defaultAvt.jpg" alt="Avatar cá nhân" />
            </div> *@
        <div class="profile-info">
            <div class="section-label"><h1>Thông tin cá nhân</h1></div>
            @if (ViewBag.profile != null)
            {
                ThanhVien data = (ThanhVien)ViewBag.profile;
                <p>Họ tên: @data.HoTen</p>
                <p>Email: @data.Email</p>
                <p>Số điện thoại: +84 @data.Sdt</p>
                <p>Địa chỉ: @data.DiaChi</p>
                <p>Ngày đăng ký: @data.Ngaydangky</p>
            }
            else
            {
                <h3>Lỗi khi tải thông tin cá nhân</h3>
            }
            <button id="btn-edit-infor" class="btn-closemodal" >Chỉnh sửa thông tin</button>
        </div>
        <div class="border-line" aria-hidden="true"></div>
    </section>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Sidebar -->
        <nav class="sidebar" aria-label="Dẫn hướng trang cá nhân">
            <button id="btn-info" class="active" type="button" aria-current="page">Thông tin cá nhân</button>
            <button id="btn-activity" type="button">Lịch sử hoạt động</button>
            <button id="btn-device" type="button">Thiết bị đã đặt</button>
        </nav>

        <!-- Content Area -->
        <section id="activity-history" class="content-area" aria-labelledby="activity-title" style="display:none">
            <h2 id="activity-title">Lịch sử hoạt động</h2>
            <table>
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>ID HĐ</th>
                        <th>Loại HĐ</th>
                        <th>Thời gian</th>
                        <th>Chi tiết</th>
                    </tr>
                </thead>
                <tbody>
                    @if (ViewBag.lshd != null && ((List<LSHoatDong>)ViewBag.lshd).Count > 0)
                    {
                        int stt = 1;
                        foreach (var item in (List<LSHoatDong>)ViewBag.lshd)
                        {
                            <tr>
                                <td>@stt</td>
                                <td>@item.mahoatdong</td>
                                <td>@item.loai</td>
                                <td>@item.thoigian.ToString("dd/MM/yyyy HH:mm")</td>
                                <td>
                                    <button class="btn-edit"
                                            data-mathanhvien="@item.mathanhvien"
                                            data-mahoatdong="@item.mahoatdong"
                                            data-loai="@item.loai"
                                            data-chitiet="@item.chitiet"
                                            data-thoigian="@item.thoigian.ToString("HH:mm:ss - dd-MM-yyyy")">
                                        Chi tiết
                                    </button>
                                </td>
                            </tr>
                            stt++;
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="5">Không có hoạt động nào.</td>
                        </tr>
                    }
                </tbody>
            </table>
        </section>
        <section id="device-history" class="content-area" style="display:none">
            <h2>Thiết bị đã đặt</h2>
            <table>
                <thead>
                    <tr>
                        @*public int madatcho { get; set; }
        public int mathanhvien { get; set; }
        public DateTime thoigianbatdau { get; set; }
        public DateTime thoigianketthuc { get; set; }
        public int mathietbi { get; set; }
        public string tenthietbi { get; set; }
        public int giathue { get; set; }
        public int soluong { get; set; }
        public string trangthai { get; set; }*@
                        <th>Mã đặt chỗ</th>
                        <th>Mã thiết bị</th>
                        <th>Tên thiết bị</th>
                        <th>Thời gian đặt</th>
                        <th>Số lượng</th>
                        <th>Giá</th>
                        <th>Tổng tiền</th>
                        <th>Trạng thái</th>
                    </tr>
                </thead>
                <tbody>
                    @if (ViewBag.Device != null && ((List<Quanlythuquanweb.Models.LichSuDatCho>)ViewBag.Device).Count > 0)
                    {
                        foreach (var item in (List<Quanlythuquanweb.Models.LichSuDatCho>)ViewBag.Device)
                        {
                            int tong = @item.giathue * @item.soluong;
                            <tr>
                                <td>@item.madatcho</td>
                                <td>@item.mathietbi</td>
                                <td>@item.tenthietbi</td>
                                <td>@item.thoigianbatdau.ToString("dd/MM/yyyy HH:mm")</td>
                                <td>@item.soluong</td>
                                <td>@item.giathue.ToString("N0") VNĐ</td>
                                <td>@tong.ToString("N0") VNĐ</td>
                                <td>@item.trangthai</td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="7">Không có thiết bị nào đã đặt.</td>
                        </tr>
                    }
                </tbody>
            </table>
        </section>

        <!--Thông tin cá nhân -->
        <section id="personal-info" class="content-area" style="display: block;">
            @if (ViewBag.profile != null)
            {
                ThanhVien data = (ThanhVien)ViewBag.profile;
                <p>Họ tên: @data.HoTen</p>
                <p>Email: @data.Email</p>
                <p>Số điện thoại: +84 @data.Sdt</p>
                <p>Địa chỉ: @data.DiaChi</p>
                <p>Ngày đăng ký: @data.Ngaydangky</p>
            }
            else
            {
                <h3>Lỗi khi tải thông tin cá nhân</h3>
            }
        </section>
    </main>
    <!-- Modal Overlay -->
    <div id="modal-overlay" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3>Chi tiết hoạt động</h3>
            <p><strong>Mã thành viên:</strong> <span id="modal-mathanhvien"></span></p>
            <p><strong>Mã hoạt động:</strong> <span id="modal-mahoatdong"></span></p>
            <p><strong>Loại:</strong> <span id="modal-loai"></span></p>
            <p><strong>Chi tiết hoạt động:</strong> <span id="modal-chitiet"></span></p>
            <p><strong>Thời gian:</strong> <span id="modal-thoigian"></span></p>
            <button id="close-modal" class="btn-closemodal" type="button">Đóng</button>
        </div>
    </div>

    <div id="edit-infor-form" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3>Chỉnh sửa thông tin</h3>
            @if (ViewBag.profile != null)
            {
                ThanhVien data = (ThanhVien)ViewBag.profile;
                <p><strong>Họ tên:</strong> <input id="hoten-input" value="@data.HoTen" /> </p>
                <p><strong>Email:</strong> <input id="email-input" value="@data.Email"/> </p>
                <p><strong>Số điện thoại:</strong> <input id="sdt-input" value="@data.Sdt" /> </p>
                <p><strong>Địa chỉ:</strong> <input id="diachi-input" value="@data.DiaChi"/> </p>
                <button id="confirm-edit-infor" class="btn-closemodal" type="button">Xác nhận</button>
                <button id="cancel-edit-infor" class="btn-closemodal" type="button">Đóng</button>
            }
            else
            {
                <h3>Lỗi khi tải thông tin cá nhân</h3>
            }

        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-container">
            <section class="address-info" aria-label="Thông tin địa chỉ">
                <h4>THUQUAN.COM</h4>
                <p>Không gian đọc sách & sáng tạo</p>
                <p><i>Địa chỉ:</i> 123 CMT8, Q3, TP HCM.</p>
                <p><i>Giờ hoạt động:</i> 8:00 AM - 22:00 PM, Thứ Hai đến Chủ Nhật</p>
            </section>

            <section aria-label="Liên hệ và hỗ trợ">
                <h4>Liên hệ & hỗ trợ</h4>
                <p>Hotline: 0909-150-909</p>
                <p>E-mail: contact@thuquan.vn</p>
                <p>Hướng dẫn đặt bàn</p>
                <p>Chính sách thuê thiết bị</p>
                <p>Quy định thu quán</p>
            </section>

            <section aria-label="Mạng xã hội & cộng đồng">
                <h4>Mạng xã hội & cộng đồng</h4>
                <a href="#" target="_blank" rel="noopener">Facebook</a>
                <a href="#" target="_blank" rel="noopener">Instagram</a>
                <a href="#" target="_blank" rel="noopener">Tiktok</a>
            </section>

            <section aria-label="Chính sách & điều khoản">
                <h4>Chính sách & điều khoản</h4>
                <p>Chính sách đặt chỗ</p>
                <p>Chính sách hoàn tiền</p>
                <p>Điều khoản sử dụng dịch vụ</p>
                <p>Chính sách bảo mật</p>
            </section>
        </div>
    </footer>
    <script>
        const btnInfo = document.getElementById('btn-info');
        const btnActivity = document.getElementById('btn-activity');


        const sectionInfo = document.getElementById('personal-info');
        const sectionActivity = document.getElementById('activity-history');
        const modalOverlay = document.getElementById('modal-overlay');
        const closeModalButton = document.getElementById('close-modal');
        const modalMathanhvien = document.getElementById('modal-mathanhvien'); // Thêm các phần tử modal
        const modalMahoadong = document.getElementById('modal-mahoatdong');
        const modalLoai = document.getElementById('modal-loai');
        const modalChitiet = document.getElementById('modal-chitiet');
        const modalThoigian = document.getElementById('modal-thoigian');

        const editInfor = document.getElementById('edit-infor-form');

        btnInfo.addEventListener('click', () => {
            sectionInfo.style.display = 'block';
            sectionActivity.style.display = 'none';

            btnInfo.classList.add('active');
            btnActivity.classList.remove('active');
        });

        document.getElementById("btn-edit-infor").addEventListener('click', () => {
            editInfor.style.display = 'flex';
        });

        document.getElementById('cancel-edit-infor').addEventListener('click', () => {
            editInfor.style.display = 'none';
        });

        document.getElementById('confirm-edit-infor').addEventListener('click', () => {
            // TODO save
            // Lấy giá trị từ các input
            let hoten = document.getElementById('hoten-input').value;
            let email = document.getElementById('email-input').value;
            let sdt = document.getElementById('sdt-input').value;
            let diachi = document.getElementById('diachi-input').value;
            // Gửi dữ liệu đến Controller để cập nhật thông tin
            alert('Cập nhật thành công')
            editInfor.style.display = 'none';
        });

        btnActivity.addEventListener('click', () => {
            sectionInfo.style.display = 'none';
            sectionActivity.style.display = 'block';

            btnActivity.classList.add('active');
            btnInfo.classList.remove('active');
        });

        document.querySelectorAll('.btn-edit').forEach(button => {
            button.addEventListener('click', () => {
                const mathanhvien = button.dataset.mathanhvien;
                const mahoatdong = button.dataset.mahoatdong;
                const loai = button.dataset.loai;
                const chitiet = button.dataset.chitiet;
                const thoigian = button.dataset.thoigian;

                modalMathanhvien.textContent = mathanhvien || '';
                modalMahoadong.textContent = mahoatdong || '';
                modalLoai.textContent = loai || '';
                modalChitiet.textContent = chitiet || '';
                modalThoigian.textContent = thoigian || '';

                modalOverlay.style.display = 'flex';
            });
        });

        closeModalButton.addEventListener('click', () => {
            modalOverlay.style.display = 'none';
        });

        // Đóng modal khi nhấp chuột bên ngoài modal
        modalOverlay.addEventListener('click', function(event) {
            if (event.target === modalOverlay) {
                modalOverlay.style.display = 'none';
            }
        });

        // Logic để hiển thị section lịch sử hoạt động sau khi tải dữ liệu (ví dụ)
        document.addEventListener('DOMContentLoaded', function() {
            // Kiểm tra xem ViewBag.LichSuHoatDong có dữ liệu hay không (bạn cần truyền một flag từ Controller nếu cần)
            const hasActivityData = @(ViewBag.lshd != null && ((List<LSHoatDong>)ViewBag.lshd).Count > 0).ToString().ToLower();
            if (hasActivityData === 'true') {
                sectionActivity.style.display = 'block';
                btnActivity.classList.add('active');
                btnInfo.classList.remove('active');
                sectionInfo.style.display = 'none';
            }
        });


         //$(document).ready(function () {
        @*var hasHistory = '@(ViewBag.LichSuHoatDong != null && ((List<LSHoatDong>)ViewBag.LichSuHoatDong).Count > 0)';
        if (hasHistory === 'True') {
            $("#activity-history").show();
        }
        });*@




        document.getElementById("btn-device").addEventListener("click", function () {
            document.getElementById("personal-info").style.display = "none";
            document.getElementById("activity-history").style.display = "none";
            document.getElementById("device-history").style.display = "block";

            document.getElementById("btn-info").classList.remove("active");
            document.getElementById("btn-activity").classList.remove("active");
            this.classList.add("active");
        });

        document.getElementById("btn-info").addEventListener("click", function () {
            document.getElementById("personal-info").style.display = "block";
            document.getElementById("activity-history").style.display = "none";
            document.getElementById("device-history").style.display = "none";

            this.classList.add("active");
            document.getElementById("btn-activity").classList.remove("active");
            document.getElementById("btn-device").classList.remove("active");
        });

        document.getElementById("btn-activity").addEventListener("click", function () {
            document.getElementById("personal-info").style.display = "none";
            document.getElementById("activity-history").style.display = "block";
            document.getElementById("device-history").style.display = "none";

            this.classList.add("active");
            document.getElementById("btn-info").classList.remove("active");
            document.getElementById("btn-device").classList.remove("active");
        });
    </script>
</body>
